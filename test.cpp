#include <stdio.h>
#include <stdint.h>
#include <vector>

extern "C"
{
size_t p4nenc256v32(uint32_t* __restrict in, size_t n, unsigned char* __restrict out);
size_t p4ndec256v32(unsigned char* __restrict in, size_t n, uint32_t* __restrict out);
}

const uint32_t testdata[2731] = {
 8794,   10,   37,    0,   24,   11,   20,   55,   17,   55,
   36,   53,   59,   51,   55,   56,   54,   65,   43,   53,
   51,   45,   55,   45,   55,   51,   55,   58,   53,   56,
   55,   55,   71,   47,   69,   57,   64,   66,   60,   64,
   63,   64,   78,   62,   68,   71,   68,   69,   50,   58,
   59,   56,   74,   56,   68,   67,   76,   76,   69,   75,
   73,   73,   82,   72,   82,   77,   82,   87,   80,   81,
   83,   84,  100,   81,   99,   92,  105,  108,   94,   96,
  104,   95,  105,   90,   99,   96,  100,  107,   97,  100,
  103,  101,  101,   94,   96,   98,   95,   95,   85,   87,
   89,   87,   96,   87,   92,   90,   91,   92,   88,   91,
   90,   88,   94,   86,   90,   90,   86,   87,   78,   79,
   81,   79,   82,   78,   79,   79,   76,   77,   68,   68,
   74,   59,   69,   59,   67,   66,   67,   69,   64,   67,
   67,   68,   74,   68,   74,   70,   74,   89,   74,   86,
   80,   84,  105,   79,   81,   85,   78,   87,   78,   87,
   82,   86,   92,   83,   84,   87,   85,   85,   72,   72,
   76,   69,   79,   69,   76,   76,   76,   77,   69,   70,
   74,   71,   84,   71,   84,   75,   79,   79,   71,   75,
   74,   67,   70,   63,   63,   67,   62,   64,   53,   53,
   60,   54,   58,   52,   58,   55,   60,   64,   58,   62,
   61,   64,   76,   64,   76,   70,   67,   69,   65,   65,
   66,   64,   68,   64,   68,   67,   72,   72,   69,   69,
   71,   62,   70,   62,   67,   67,   67,   71,   67,   67,
   69,   68,   70,   68,   70,   68,   70,   73,   68,   68,
   71,   66,   74,   66,   73,   71,    0,    0,    0,    0,
    0,   67,   69,   62,   66,   66,   63,   70,   63,   66,
   67,   64,   69,   64,   69,   67,   69,   75,   69,   75,
   72,   73,   75,   73,   75,   73,   76,   83,   76,   83,
   79,   83,   83,   77,   78,   80,   80,   86,   80,   86,
   82,   91,  101,   91,  101,   97,   99,  101,   96,  101,
   99,  107,  111,  106,  111,  107,  111,  120,  110,  116,
  114,  116,  116,  110,  110,  112,  113,  117,  107,  107,
  112,  110,  110,  106,  106,  108,  106,  107,  103,  105,
  105,  106,  106,   94,   95,  100,   97,  102,   96,  102,
   98,  105,  107,  105,  107,  106,  104,  108,  104,  106,
  105,  106,  106,  101,  101,  104,  102,  102,   98,   99,
   99,   97,  100,   95,   98,   98,   96,   96,   93,   93,
   95,   87,   87,   85,   85,   86,   83,   83,   79,   81,
   81,   75,   77,   72,   72,   75,   74,   76,   73,   73,
   75,   74,   75,   73,   74,   74,   74,   77,   73,   75,
   75,   77,   85,   77,   84,   81,   92,   92,   82,   84,
   86,   83,   83,   82,   82,   82,   80,   82,   80,   81,
   81,   84,   93,   84,   88,   88,   91,   91,   86,   89,
   87,   88,   89,   86,   88,   88,   87,   89,   85,   89,
   87,   90,   98,   90,   97,   93,   98,   98,   88,   90,
   94,   90,   96,   89,   95,   92,   96,   97,   92,   97,
   94,   98,  106,   94,   94,  100,   96,  106,   95,  104,
  101,  104,  106,  101,  106,  103,  106,  109,  104,  109,
  106,  109,  110,  104,  105,  107,  106,  106,   97,   97,
  102,   96,   97,   83,   83,   91,   85,   88,   83,   83,
   87,   83,   85,   76,   79,   79,   73,   78,   73,   77,
   77,   79,   82,   78,   78,   80,   79,   79,   69,   78,
   73,   79,   81,   77,   81,   79,   81,   83,   77,   80,
   79,   80,   88,   80,   87,   84,   87,   87,   85,   85,
   85,   87,   87,   84,   85,   85,   85,   91,   84,   89,
   88,   86,   86,   80,   80,   83,   81,   84,   80,   82,
   83,   87,   88,   86,   88,   87,   87,   91,   85,   91,
   89,   94,  100,   94,  100,   98,  100,  101,   97,   98,
   99,   99,  100,   98,   98,   99,  101,  106,  101,  106,
  103,  108,  109,  104,  104,  107,  104,  105,  101,  103,
  103,  104,  108,  104,  108,  106,  109,  111,  106,  108,
  108,  110,  120,  110,  120,  114,  119,  119,  115,  116,
  117,  118,  123,  118,  120,  120,  122,  122,  122,  122,
  122,  122,  126,  121,  126,  123,  128,  134,  128,  129,
  130,  132,  136,  130,  136,  132,  137,  138,  129,  129,
  134,  128,  139,  128,  139,  134,  141,  141,  136,  137,
  137,  137,  139,  134,  136,  137,  137,  139,  133,  133,
  135,  133,  137,  132,  137,  134,  137,  141,  137,  141,
  139,  139,  140,  134,  136,  138,  132,  133,  131,  132,
  132,  134,  134,  129,  129,  132,  131,  131,  125,  127,
  127,  129,  132,  129,  130,  130,  129,  129,  127,  129,
  128,  128,  129,  120,  120,  126,  121,  129,  121,  129,
  124,  130,  130,  129,  129,  130,  129,  129,  115,  120,
  119,  121,  127,  121,  126,  125,  126,  132,  126,  129,
  129,  132,  132,  121,  126,  126,  126,  126,  124,  124,
  125,  123,  123,  120,  120,  122,  120,  121,  119,  119,
  120,  120,  124,  120,  124,  121,  125,  131,  125,  131,
  126,  131,  131,  125,  125,  127,  127,  128,  126,  126,
  127,  127,  127,  123,  126,  125,  125,  128,  125,  128,
  127,  129,  130,  128,  129,  129,  128,  128,  125,  125,
  127,  125,  125,  119,  119,  121,  118,  122,  118,  120,
  120,  119,  120,  119,  120,  120,  118,  122,  118,  122,
  121,  123,  123,  116,  116,  120,  116,  116,  109,  109,
  113,  112,  114,  110,  114,  112,  113,  117,  113,  115,
  115,  114,  115,  113,  113,  114,  116,  121,  115,  117,
  119,  118,  118,  117,  118,  117,  118,  122,  118,  122,
  120,  124,  124,  124,  124,  124,  126,  126,  121,  121,
  122,  123,  123,  121,  122,  122,  123,  123,  120,  120,
  121,  118,  118,  116,  118,  117,  118,  118,  116,  116,
  117,  116,  120,  116,  120,  118,  119,  123,  119,  123,
  122,  123,  124,  123,  123,  123,  124,  130,  124,  130,
  127,  129,  129,  124,  124,  127,  125,  125,  121,  121,
  123,  120,  122,  109,  120,  116,  122,  123,  121,  123,
  122,  124,  129,  124,  129,  125,  128,  129,  126,  126,
  127,  127,  127,  127,  127,  127,  125,  131,  125,  128,
  128,  127,  133,  127,  132,  130,  132,  134,  132,  134,
  133,  134,  135,  133,  133,  134,  135,  135,  133,  134,
  134,  134,  136,  134,  136,  135,  136,  145,  136,  145,
  140,  146,  146,  142,  144,  144,  145,  150,  145,  150,
  148,  152,  152,  149,  149,  151,  151,  155,  149,  155,
  153,  156,  159,  156,  156,  156,  159,  162,  157,  162,
  159,  160,  160,  158,  158,  160,  158,  158,  155,  155,
  156,  156,  156,  155,  156,  155,  155,  161,  155,  161,
  158,  163,  164,  161,  162,  162,  163,  163,  162,  163,
  163,  162,  164,  157,  157,  161,  157,  159,  154,  154,
  157,  154,  160,  154,  160,  158,  161,  166,  161,  166,
  163,  165,  165,  163,  163,  164,  165,  166,  163,  166,
  164,  167,  170,  167,  170,  168,  169,  170,  168,  170,
  169,  170,  171,  165,  165,  168,  168,  168,  165,  165,
  166,  166,  167,  164,  166,  165,  163,  166,  163,  166,
  165,  169,  175,  169,  174,  172,  174,  178,  174,  178,
  177,  177,  180,  177,  179,  178,  180,  186,  180,  181,
  183,  182,  182,  174,  174,  179,  172,  178,  172,  178,
  176,  176,  178,  176,  178,  177,  178,  183,  178,  183,
  180,  184,  184,  178,  179,  181,  180,  186,  180,  184,
  185,  181,  183,  181,  183,  182,  181,  184,  181,  184,
  183,  185,  187,  183,  183,  185,  182,  186,  182,  186,
  184,  185,  185,  183,  183,  184,  182,  183,  181,  181,
  182,  182,  184,  182,  184,  183,  182,  182,  176,  179,
  181,  176,  176,  165,  167,  170,  167,  167,  162,  164,
  165,  166,  167,  165,  165,  166,  169,  172,  169,  171,
  172,  170,  170,  168,  168,  169,  168,  169,  168,  169,
  168,  168,  168,  167,  167,  168,  170,  175,  170,  175,
  173,  178,  189,  176,  188,  181,  189,  199,  188,  194,
  195,  194,  204,  190,  202,  198,  202,  203,  197,  202,
  202,  201,  203,  199,  203,  201,  200,  200,  200,  200,
  200,  197,  200,  197,  198,  198,  198,  198,  192,  193,
  194,  194,  196,  194,  196,  195,  195,  195,  190,  190,
  193,  188,  188,  184,  184,  187,  181,  181,  173,  178,
  177,  180,  180,  176,  176,  177,  176,  176,  172,  172,
  173,  173,  178,  173,  178,  175,  180,  184,  180,  182,
  181,  183,  183,  181,  181,  182,  181,  181,  178,  179,
  180,  177,  178,  172,  175,  175,  175,  178,  175,  178,
  176,    0,    0,    0,    0,    0,  175,  177,  174,  177,
  176,  177,  178,  173,  174,  177,  174,  174,  169,  170,
  172,  170,  170,  166,  166,  169,  167,  168,  163,  168,
  167,  168,  168,  161,  161,  165,  162,  162,  161,  162,
  162,  161,  162,  161,  162,  161,  162,  162,  159,  162,
  161,  162,  162,  159,  160,  161,  159,  159,  159,  159,
  159,  155,  157,  154,  157,  155,  157,  158,  151,  153,
  156,  152,  154,  148,  154,  151,  151,  155,  151,  153,
  154,  153,  155,  152,  153,  153,  151,  151,  147,  150,
  150,  148,  150,  147,  147,  149,  151,  151,  151,  151,
  151,  151,  155,  151,  155,  153,  158,  160,  156,  160,
  159,  158,  158,  148,  151,  154,    0,    0,    0,    0,
    0,  154,  155,  149,  149,  151,  147,  150,  144,  147,
  147,  146,  147,  144,  146,  145,  149,  149,  149,  149,
  149,  149,  153,  148,  153,  150,  151,  154,  151,  153,
  152,  151,  152,  151,  152,  151,  154,  154,  151,  151,
  152,  152,  152,  149,  149,  150,  148,  152,  148,  152,
  149,  153,  156,  153,  156,  154,  156,  166,  155,  161,
  159,  161,  163,  160,  160,  161,  162,  163,  161,  162,
  162,  162,  165,  160,  164,  163,  165,  176,  165,  172,
  171,  175,  177,  174,  174,  175,  172,  172,  165,  165,
  168,  163,  163,  161,  162,  162,  162,  166,  162,  164,
  164,  166,  166,  165,  166,  165,  166,  167,  165,  167,
  166,  166,  166,  162,  162,  164,  161,  161,  159,  160,
  160,  162,  165,  159,  159,  162,  158,  162,  151,  151,
  156,  153,  155,  153,  154,  153,  153,  155,  153,  155,
  154,  155,  155,  154,  155,  155,  154,  154,  152,  152,
  153,  153,  155,  151,  155,  153,  153,  153,  151,  151,
  152,  152,  152,  150,  151,  151,  148,  150,  147,  148,
  148,  148,  148,  146,  148,  148,  146,  149,  145,  149,
  146,  148,  148,  144,  148,  146,  148,  149,  147,  148,
  148,  148,  150,  148,  150,  148,  149,  149,  143,  143,
  146,  143,  143,  141,  141,  142,  140,  140,  138,  138,
  139,  139,  143,  139,  143,  141,  144,  147,  144,  145,
  145,  145,  145,  141,  141,  143,  140,  143,  138,  143,
  141,  146,  149,  146,  149,  148,  149,  152,  148,  152,
  150,  151,  152,  150,  150,  151,  149,  149,  142,  145,
  147,  145,  145,  140,  140,  143,  140,  140,  136,  136,
  140,  137,  137,  134,  135,  135,  134,  134,  126,  129,
  130,  131,  135,  131,  134,  133,  133,  133,  130,  131,
  133,  132,  134,  130,  133,  132,  133,  134,  133,  134,
  134,  135,  140,  133,  133,  136,  132,  134,  131,  134,
  133,  135,  137,  133,  133,  136,  134,  141,  134,  141,
  137,  143,  145,  143,  144,  144,  142,  145,  137,  143,
  141,  144,  144,  140,  141,  142,  142,  142,  138,  139,
  140,  139,  143,  139,  143,  141,  143,  145,  141,  145,
  143,  145,  151,  145,  146,  147,  148,  153,  146,  153,
  149,  154,  167,  154,  167,  162,  167,  170,  165,  166,
  167,  166,  168,  163,  163,  166,  165,  166,  162,  166,
  165,  165,  167,  164,  165,  165,  166,  166,  157,  159,
  160,  161,  169,  161,  167,  165,  168,  170,  166,  167,
  168,  167,  170,  164,  169,  167,  169,  173,  168,  171,
  171,  170,  174,  166,  170,  170,  169,  180,  169,  179,
  174,  180,  189,  179,  189,  183,  189,  190,  179,  183,
  184,  183,  190,  182,  188,  185,  189,  192,  179,  179,
  187,  179,  181,  176,  176,  179,  176,  181,  171,  172,
  176,  171,  189,  168,  188,  179,  189,  191,  183,  186,
  188,  185,  193,  184,  193,  187,  193,  194,  188,  190,
  191,  192,  197,  191,  197,  193,  199,  201,  190,  193,
  197,  193,  199,  191,  198,  194,  198,  199,  187,  194,
  193,  193,  200,  193,  199,  196,  199,  204,  192,  197,
  198,28403, 2783, 6660, 9678, 1243, 2213,13146, 1289, 7657,
 7712, 6140, 4078, 3220, 5751, 4206,16142, 5414, 2086, 2698,
 3028, 5375, 2910, 2180, 4717, 3044, 5616, 2814, 5259, 8475,
 6880,11973, 2212, 7893, 3587,17056, 7047, 1627, 2073, 2007,
 1287, 2087, 3966, 1662,  620,  847,  660,  981, 1834, 3565,
 3332, 2291,    0, 3280, 2879, 1743, 2295,  980, 5997, 4062,
 2051, 4886, 1925, 3028, 4118, 1689, 2207, 1352,  645, 1827,
 2612,  230, 2619, 2200, 1809, 3416, 2831,  945,  753, 1458,
 1845, 1579, 2330, 1596, 2407, 1680,  848, 3303, 1238, 1808,
 3309, 1417, 2258, 3736, 1957, 4093, 2743,10207, 4709, 2285,
 4445, 4354, 2840, 4205, 1859, 1788, 4151, 1436, 3727, 4942,
 1368, 2140, 4792, 4433, 1925, 1106, 2708, 1017, 2306,  996,
 1323, 3063, 1910, 2122, 3157, 4857, 3285, 1759,  454, 3068,
 2422, 2560, 3196, 2425, 2220, 2583, 2753, 3038, 5165, 5386,
 1485, 2076, 1466, 3603, 5683, 3135, 2209,  961, 6989, 2971,
 2803, 3398,  496,  707,  878, 2181,  993, 1407, 1750,  400,
 1492, 1994, 1263, 1813, 2167,  876, 2267, 2647,  928, 2373,
 1248, 1413, 3413,  947, 1761,  407, 2244,  621, 1680, 1688,
 1288, 1924, 1420, 1232, 2303, 2405, 1011, 7675,  916, 1337,
 2200,  142, 2769, 1706,  403, 2264, 1072,  834, 1831, 2171,
 1417, 2099, 2580, 3927,  811,  835, 4095, 1114, 2550, 2239,
  745, 2900, 3065, 3145, 1133, 1099,  835, 2195, 1099, 1174,
 1273, 2495, 1421, 2222,  529, 3204, 3460, 3490, 1744, 1607,
 1322, 3893, 8930, 1399,  859, 2419, 2494, 1830, 1027, 1561,
 3605, 3372, 1917,  937, 1224, 1136, 1660, 1749, 6861,21262,
14241, 8816,12088, 2605,  842, 1090,  749, 1924, 2369,  710,
 5677, 2564, 1077, 3238,  715,  799, 1891, 3417, 1259,    0,
 2414,27400, 6644, 3656, 4148, 4695, 1456, 1419, 4374, 1770,
 1291, 1750, 3973, 2640, 1344, 2203, 3930,  961,  312, 2519,
 2705, 6007,    0, 2540, 3147, 5285,  891, 2183, 2231, 1042,
 1558, 1226, 2519, 1331, 4202, 1938, 2190, 3535, 3039, 2679,
 1697, 1611, 2484, 1171, 2256,  788, 1060, 4956, 2156, 2735,
  879, 1924, 1649, 4780, 1597, 1885, 2172, 1389, 3615, 2275,
 1510,  631, 3665, 2086,  202, 2939,  750, 3680, 2690, 1471,
 5109, 2904, 1609, 2815, 1261, 1356, 7553, 3363, 1952, 3082,
 1221, 5231, 2141, 4693, 3265, 1465, 6591, 2409, 4231, 4847,
 5134,10763, 8081, 8924, 9282, 7935, 9129, 9357, 8409, 8264,
 8982,12758,10611,16705, 9499,12481,17921,13824,12470,11633,
18901,22913,19366,23705,19166,24975,33351,34516,45279,28241,
97983,   87,   37,   60,  151,   20,   42,  150,   23,   99,
  110,   64,   79,   44,   63,   47,   70,   63,   36,   44,
   47,   67,   41,   32,   37,   32,   79,   50,   81,  106,
  119,  165,   38,  109,   44,  175,   82,   30,   39,   36,
   24,   35,   25,   29,   14,   18,   16,   14,   25,   41,
   39,   43,    0,   45,   44,   24,   37,   26,  106,   55,
   42,   82,   37,   68,   78,   34,   44,   29,   12,   34,
   40,    7,   51,   36,   41,   65,   54,   34,   23,   26,
   32,   40,   50,   45,   54,   45,   27,   63,   26,   29,
   61,   26,   39,   68,   32,   48,   42,  129,   75,   38,
   70,   78,   54,   60,   38,   33,   63,   33,   22,   70,
   25,   39,   89,   73,   23,   25,   60,   24,   43,   17,
   20,   47,   38,   44,   36,   73,   53,   35,    8,   51,
   51,   45,   51,   35,   32,   40,   37,   39,   37,   67,
   21,   47,   20,   52,   14,   52,   32,   18,   65,   46,
   31,   52,   12,   10,   20,   35,   26,   23,   25,    4,
   28,   33,   18,   37,   45,   22,   32,   36,   21,   41,
   18,   29,   46,   20,   26,   12,   30,   13,   25,   27,
   22,   45,   28,   17,   35,   42,   15,   63,   14,   25,
   34,    7,   47,   34,    7,   40,   27,   12,   29,   44,
   23,   29,   35,   48,   13,   21,   63,   19,   48,   26,
   16,   51,   33,   50,   21,   16,   14,   37,   15,   26,
   17,   34,    8,   28,   13,   54,   53,   41,   25,   24,
   22,   43,   43,   22,   12,   31,   42,   34,   16,   29,
   43,   56,   35,   18,   17,   29,   24,   25,  132,  333,
  238,  173,   82,   54,   14,   13,   21,   25,   36,   39,
   82,   25,   22,   57,   10,   13,   46,   52,   19,    0,
   51,   43,   67,   57,   58,   76,   31,   20,   45,   31,
   34,   33,   58,   58,   22,   39,   58,   13,    7,   43,
   23,   84,    0,   35,   50,   63,   33,   54,   44,   21,
   20,   17,   51,   24,   41,   31,   39,   55,   42,   47,
   23,   18,   64,   19,   37,   18,   22,   57,   49,   40,
   18,   37,   36,   58,   36,   38,   36,   25,   75,   45,
   27,   23,   59,   35,    3,   53,   17,   72,   59,   31,
   95,   43,   31,   45,   29,   40,  117,   47,   42,   56,
   25,   82,   37,   73,   64,   26,  102,   45,   71,   82,
   69,  162,  107,  135,  149,  120,  138,  131,  113,  113,
  130,  162,  138,  220,  129,  156,  223,  180,  169,  164,
  260,  298,  243,  310,  238,  290,  390,  333,  426,  319,
  769
};

int main()
{
    std::vector<uint32_t> data(testdata, testdata + std::size(testdata));
    const size_t sz = data.size();
    data.resize(data.size() + 256);
    std::vector<unsigned char> ret;
    ret.resize(sz * 4);

    size_t ret1 = p4nenc256v32(data.data(), sz, ret.data());

    std::vector<uint32_t> data_decoded;
    data_decoded.resize(data.size());

    size_t ret2 = p4ndec256v32(ret.data(), sz, data_decoded.data());

    if (ret1 != ret2)
    {
        printf("error ret1:%zu != ret2:%zu\n", ret1, ret2);
        return 1;
    }
    for (size_t i = 0; i < sz; ++i)
    {
        if (data[i] != data_decoded[i])
        {
            printf("error data[%zu]:%u != data_decoded[%zu]:%u\n", i, data[i], i, data_decoded[i]);
            return 1;
        }
    }
    printf("OK\n");
}
